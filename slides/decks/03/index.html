<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Lesson 03</title>

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/black.css">
		<link rel="stylesheet" type="text/css" href="../../css/asciinema-player.css" />

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="../../plugin/highlight/github-dark.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section id="introduction">
					<h1>Authentication and authorization</h1>
					<h3>Lesson 03</h3>
					<h4>SWABE-01</h4>
				</section>
				<section>
					<h2>Agenda</h2>
					<ul>
						<li>Secure network communication with HTTPS</li>
						<li>JSON Web Tokens</li>
						<li>Authentication</li>
					</ul>
				</section>
				<section>
					<section>
						<h2>HTTPS</h2>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>We need HTTPS for three reasons:
								<ul>
									<li><mark>Privacy</mark> Prevent bad actors from eavesdropping</li>
									<li><mark>Integrity</mark> Prevent bad actors to modify the message</li>
									<li><mark>Identification</mark> Guarantee the identity of the sender</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h2>TLS Handshake</h2>
						<mark>TODO: Insert diagram</mark>
						<aside class="notes" aria-label="notes">
							<ol>
								<li>Client: Client Helloâ€”sends a list of supported SSL/TLS version and encryption algoritms (cipher suite)</li>
								<li>Server: Server Helloâ€”sends response with selected ciphers</li>
								<li>Server: Server and certificate (which includes public key)</li>
								<li>Server: Server Done</li>
								<li>Client: Client Key Exchange (checks certificate before)â€”responds with pre-master key and encrypt with server public key</li>
								<li>Client: Cipher spec change</li>
								<li>Client: Finished</li>
								<li>Server: Cipher spec change</li>
								<li>Server: Finished</li>
							</ol>
							<h4>References</h4>
							<ul>
								<li><a href="https://www.thesslstore.com/blog/explaining-ssl-handshake/">The TLS Handshake: Taking a closer look - Hashed Out by The SSL Storeâ„¢</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Certificate authorities (CA)</h2>
						<ul>
							<li>A trusted entity that issues digital certificates</li>
							<li>CAs are trusted by vendors by whitelisting their root certificates</li>
						</ul>
					</section>
					<section>
						<h2>HTTPS in Node.js</h2>
						<pre data-id="code-animation"><code class='typescript' data-trim data-line-numbers="|9-12|14-18|20-22|"><script type="text/template">
							import https from 'https';
							import express from 'express';
							import fs from 'fs';
							import path from 'path';
							
							const app = express();
							const port = 3000;
							
							const options=  {
								key: fs.readFileSync(path.join(__dirname, '../selfsigned.key')),
								cert: fs.readFileSync(path.join(__dirname, '../selfsigned.crt'))
							}
							
							app.get('', (req, res) => {
								res.json({
									"message": "Hello, HTTPS! ðŸ‘‹"
								});
							});
							
							https.createServer(options, app).listen(port, () => {
								console.log(`Running 'secure-http' on ${port}`);
							});
						</script></code></pre>
						<small>examples/lesson-03/secure-http/src/index.ts</small>
					</section>
				</section>
				<section>
					<section>
						<h2>JSON Web Token</h2>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>An open standard defined in RFC 7519</li>
							<li>Compact and self-contained secure data transmission</li>
							<li>Use cases: 
								<ul>
									<li><mark>Authorization</mark> the most common scenario, where the token is used to check if the user has permission to perform requested actions</li>
									<li><mark>Information exchange</mark> secure transmission of data through signing</li>
								</ul>
							</li>
							<li>Can be signed with symmetric and asymmetric keys</li>
							<li></li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://jwt.io/introduction">JSON Web Token Introduction - jwt.io</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h1 style="font-family: monospace"><span style="color: tomato">xxxxx</span>.<span style="color: cornflowerblue">yyyyy</span>.<span style="color: goldenrod">zzzzz</span></code></h1>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://jwt.io/introduction">JSON Web Token Introduction - jwt.io</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2 style="font-family: monospace; color: tomato">Header</h2>
						<ul>
							<li>The header (typically consists of two parts)
								<ul>
									<li>Token type</li>
									<li>Signing algorithm</li>
								</ul>
							</li>
							<li>The header is <code>base64Url</code> encoded</li>
						</ul>
						<pre data-id="code-animation"><code class='json' data-trim data-line-numbers><script type="text/template">	
							{
								"alg": "RS256",
								"typ": "JWT",
								"x5u": "http://localhost:3000/auth-rsa256.key.pub"
							}
						</script></code></pre>
						<small>Generated with examples/lesson-03/authentication/src/controller/authentication.controller.ts:11-21</small>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://jwt.io/introduction">JSON Web Token Introduction - jwt.io</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2 style="font-family: monospace; color: cornflowerblue">Payload</h2>
						<ul>
							<li>The payload contains the claims (statements about an entity)
								<ul>
									<li><mark>Registered claims</mark> are recommended to allow interoperability with third-party applications</li>
									<li><mark>Public claims</mark> are custom (private) claims meant for public consumption. Must collision-resistant or registered</li>
									<li><mark>Private claims</mark> are defined and controlled by individual organizations</li>
								</ul>
							</li>
							<li>The payload is <code>Base64URL</code> encoded</li>
						</ul>
						<pre data-id="code-animation"><code class='json' data-trim data-line-numbers><script type="text/template">
							{
								"email": "ctrl@hey.com",
								"admin": true,
								"iat": 1645018456,
								"exp": 1645022056
							}
						</script></code></pre>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://jwt.io/introduction">JSON Web Token Introduction - jwt.io</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2 style="font-family: monospace; color: goldenrod">Signature</h2>
						<ul>
							<li>Generated by hashing the <code>base64Url</code> encoded <span style="font-family: monospace; color: tomato">HEADER</span> and <span style="font-family: monospace; color: cornflowerblue">PAYLOAD</span> with the specified algorithm and a secret</li>
							<li>Used to verify the token has not been tampered with, and that it has been produced by a trusted entity</li>
						</ul>
						<pre data-id="code-animation"><code class='json' data-trim data-line-numbers><script type="text/template">
							HMACSHA256(
								base64UrlEncode(header) + "." +
								base64UrlEncode(payload),
								SECRET
							)
						</script></code></pre>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://jwt.io/introduction">JSON Web Token Introduction - jwt.io</a></li>
							</ul>
						</aside>
					</section>
				</section>
				<section>
					<section>
						<h2>Authentication in Node.js</h2>
					</section>
					<section>
						<h2>Overview</h2>
					</section>
					<section>
						<h2>Handling passwords</h2>
					</section>
					<section>
						<h2>Hashing modules</h2>
					</section>
					<section>
						<h2>Adding methods to Mongoose</h2>
					</section>
				</section>
				<section>
					<h2>Wrap-up</h2>
				</section>
			</div>
		</div>
		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script src="../../js/asciinema-player.js"></script>

		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: true,
				pdfSeparateFragments: false,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
